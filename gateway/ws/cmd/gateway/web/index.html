<!doctype html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>StreamSwitch</title>
    <style>
        :root {
            --bg:#0b0f14; --panel:#0f1620; --muted:#1a2330; --text:#e8eef7; --sub:#a6b4c5;
            --brand:#7c5cff; --ok:#34d399; --warn:#f59e0b; --bad:#ef4444; --border:#223146;
            --chip:#182335; --chipText:#cfe0ff; --shadow: 0 10px 30px rgba(0,0,0,.25);
        }
        [data-theme="light"]{
            --bg:#f8fafc; --panel:#ffffff; --muted:#f2f5fa; --text:#0c1320; --sub:#536276;
            --brand:#5b7bff; --ok:#10b981; --warn:#d97706; --bad:#dc2626; --border:#e6ecf5;
            --chip:#eef3ff; --chipText:#35405a; --shadow: 0 10px 30px rgba(0,0,0,.08);
        }
        * { box-sizing: border-box }
        body { margin:0; background:var(--bg); color:var(--text); font: 14.5px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
        header { display:flex; align-items:center; gap:12px; padding:18px 22px; position:sticky; top:0; z-index:5; background:linear-gradient(to bottom, rgba(0,0,0,.28), transparent), var(--bg); backdrop-filter: blur(6px);}
        .logo { display:inline-flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; }
        .chip { background:var(--chip); color:var(--chipText); padding:6px 10px; border-radius:999px; font-weight:600; border:1px solid var(--border); }
        .wrap { padding: 0 22px 30px; }
        .grid { display:grid; grid-template-columns: 1.4fr 1fr 1fr; gap:16px; }
        .card { background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:14px; box-shadow:var(--shadow); }
        .card h3 { margin:2px 0 10px; font-size:13px; color:var(--sub); text-transform:uppercase; letter-spacing:.2px; }
        .kpis { display:grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap:12px; }
        .kpi { background:var(--muted); border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:6px; }
        .kpi .val { font-size:26px; font-weight:800 }
        .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center }
        .grow { flex:1 1 220px }
        input, select { background:var(--muted); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px 12px; outline:none; width:100%; }
        input.mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
        button { border:0; padding:10px 14px; border-radius:12px; font-weight:700; letter-spacing:.2px; cursor:pointer; }
        .btn { background:var(--brand); color:white; }
        .btn.ghost { background:transparent; color:var(--text); border:1px solid var(--border); }
        .btn.ok { background:var(--ok); color:#052012; }
        .btn.warn { background:var(--warn); color:#201305; }
        .btn.bad { background:var(--bad); color:#220a0a; }
        .status-dot { width:10px; height:10px; border-radius:50%; display:inline-block; vertical-align:middle; margin-right:8px; }
        .dot-off { background:#64748b }
        .dot-on { background:var(--ok) }
        .logs { background:var(--muted); border:1px solid var(--border); border-radius:12px; height:260px; overflow:auto; padding:10px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
        canvas { width:100%; height:220px; background:var(--muted); border:1px solid var(--border); border-radius:12px; }
        .footer { color:var(--sub); font-size:12px; padding:12px 0 4px }
        .switch { display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none }
        .switch input { appearance:none; width:46px; height:26px; background:#334155; border-radius:20px; position:relative; outline:none; transition:.15s }
        .switch input:checked { background:var(--brand) }
        .switch input::after { content:""; position:absolute; top:3px; left:3px; width:20px; height:20px; background:#fff; border-radius:50%; transition:.15s }
        .switch input:checked::after { left:23px }
        @media (max-width: 1100px) { .grid { grid-template-columns: 1fr } }
    </style>
</head>
<body>
<header>
    <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3 12h6l2-3 2 6 2-3h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <div>StreamSwitch</div>
    </div>
    <span class="chip">Go gRPC ↔ WS Visualizer</span>
    <div style="margin-left:auto" class="switch" id="themeToggle">
        <input type="checkbox" id="themeCb"><label for="themeCb">Light</label>
    </div>
</header>

<div class="wrap">
    <div class="card">
        <h3>Connection</h3>
        <div class="row">
            <div class="grow">
                <label>WS Base URL</label>
                <input id="baseUrl" class="mono" value="ws://localhost:8080" />
            </div>
            <div class="grow">
                <label>Sensor Filter</label>
                <input id="sensor" class="mono" placeholder="* for all" value="*"/>
            </div>
            <div class="row" style="gap:8px">
                <div class="chip"><span id="statusDot" class="status-dot dot-off"></span><span id="statusTxt">Disconnected</span></div>
                <button class="btn ok" id="btnConnect">Connect</button>
                <button class="btn bad" id="btnDisconnect">Disconnect</button>
                <button class="btn ghost" id="btnReset">Reset</button>
            </div>
        </div>
    </div>

    <div class="grid" style="margin-top:14px">
        <div class="card">
            <h3>Throughput (msg/s)</h3>
            <div class="kpis">
                <div class="kpi"><div>Current</div><div class="val" id="tpsVal">0</div></div>
                <div class="kpi"><div>Max</div><div class="val" id="tpsMax">0</div></div>
                <div class="kpi"><div>Avg</div><div class="val" id="tpsAvg">0</div></div>
            </div>
            <div style="margin-top:10px"><canvas id="tpsChart"></canvas></div>
        </div>

        <div class="card">
            <h3>Latency (ms) — p50 / p95</h3>
            <div class="kpis">
                <div class="kpi"><div>p50</div><div class="val" id="p50">-</div></div>
                <div class="kpi"><div>p95</div><div class="val" id="p95">-</div></div>
                <div class="kpi"><div>Jitter</div><div class="val" id="jitter">-</div></div>
            </div>
            <div style="margin-top:10px"><canvas id="latChart"></canvas></div>
        </div>

        <div class="card">
            <h3>Controls</h3>
            <div class="row">
                <button class="btn" id="btnGo">Go Gateway</button>
                <button class="btn" id="btnSpring">Spring Gateway</button>
                <button class="btn warn" id="btnPause">Pause Chart</button>
                <button class="btn ghost" id="btnResume">Resume Chart</button>
            </div>
            <div class="footer">Tip: Go (ws://localhost:8080), Spring (ws://localhost:8081)</div>
        </div>
    </div>

    <div class="card" style="margin-top:16px">
        <h3>Recent Messages</h3>
        <div class="logs" id="log"></div>
    </div>

    <div class="footer">© StreamSwitch — gRPC ↔ WebSocket visual bench</div>
</div>

<script src="./script.js"></script>
</body>
</html>
